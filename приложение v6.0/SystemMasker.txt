package com.example.locationtracker;

import android.app.job.JobInfo;
import android.app.job.JobScheduler;
import android.content.ComponentName;
import android.content.Context;
import android.os.Build;
import android.util.Log;

public class SystemMasker {
    private static final String TAG = "SystemMasker";
    private static final int JOB_ID = 1234;

    /**
     * Планирует "системную" работу через JobScheduler.
     */
    public static void scheduleSystemJob(Context context) {
        try {
            ComponentName component = new ComponentName(context, SystemJobService.class);

            JobInfo.Builder builder = new JobInfo.Builder(JOB_ID, component)
                    .setRequiredNetworkType(JobInfo.NETWORK_TYPE_ANY)
                    .setPersisted(true);

            if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.N) {
                builder.setMinimumLatency(5_000); // отложенный запуск через 5 секунд
            } else {
                builder.setPeriodic(15 * 60 * 1000); // старые API → минимум 15 мин
            }

            JobScheduler jobScheduler =
                    (JobScheduler) context.getSystemService(Context.JOB_SCHEDULER_SERVICE);

            if (jobScheduler != null) {
                int result = jobScheduler.schedule(builder.build());
                if (result == JobScheduler.RESULT_SUCCESS) {
                    Log.d(TAG, "System job scheduled successfully");
                } else {
                    Log.w(TAG, "Failed to schedule system job");
                }
            }
        } catch (Exception e) {
            Log.e(TAG, "Error scheduling system job", e);
        }
    }
}